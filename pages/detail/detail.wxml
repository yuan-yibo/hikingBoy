<!--pages/detail/detail.wxml-->
<view class="container">
  <!-- ç…§ç‰‡è½®æ’­ -->
  <view class="photo-swiper-container" wx:if="{{record.photos && record.photos.length > 0}}">
    <swiper 
      class="photo-swiper" 
      indicator-dots="{{true}}"
      indicator-color="rgba(255, 255, 255, 0.5)"
      indicator-active-color="#FF6B9D"
      autoplay="{{false}}"
      circular="{{true}}"
      bindchange="onSwiperChange"
    >
      <swiper-item wx:for="{{record.photos}}" wx:key="index">
        <image class="swiper-image" src="{{item}}" mode="aspectFill" bindtap="previewImage" data-url="{{item}}"></image>
      </swiper-item>
    </swiper>
    <view class="photo-indicator">{{currentPhotoIndex + 1}}/{{record.photos.length}}</view>
  </view>

  <!-- æ— ç…§ç‰‡å ä½ -->
  <view class="no-photo-placeholder" wx:else>
    <text class="placeholder-icon">ğŸ”ï¸</text>
  </view>

  <!-- è¯¦æƒ…å¡ç‰‡ -->
  <view class="detail-card">
    <!-- å±±å -->
    <view class="mountain-title">
      <text class="mountain-icon">ğŸ”ï¸</text>
      <text class="mountain-name">{{record.mountainName}}</text>
    </view>

    <!-- ä¿¡æ¯åˆ—è¡¨ -->
    <view class="info-list">
      <view class="info-item">
        <view class="info-icon">ğŸ“…</view>
        <view class="info-content">
          <view class="info-label">æ—¥æœŸ</view>
          <view class="info-value">{{record.date}}</view>
        </view>
      </view>

      <view class="info-item" wx:if="{{record.distance}}">
        <view class="info-icon">ğŸ“</view>
        <view class="info-content">
          <view class="info-label">å…¬é‡Œæ•°</view>
          <view class="info-value">{{record.distance}} km</view>
        </view>
      </view>

      <view class="info-item" wx:if="{{record.duration}}">
        <view class="info-icon">â±ï¸</view>
        <view class="info-content">
          <view class="info-label">æ—¶é•¿</view>
          <view class="info-value">{{record.duration}}</view>
        </view>
      </view>

      <view class="info-item" wx:if="{{record.weather}}">
        <view class="info-icon">{{record.weatherIcon}}</view>
        <view class="info-content">
          <view class="info-label">å¤©æ°”</view>
          <view class="info-value">{{record.weather}}</view>
        </view>
      </view>
    </view>

    <!-- ç¬”è®° -->
    <view class="notes-section" wx:if="{{record.notes}}">
      <view class="notes-title">ğŸ“ è®°å½•</view>
      <view class="notes-content">{{record.notes}}</view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <button class="action-btn share-btn" bindtap="showShareModal" style="background: linear-gradient(135deg, #FFA500 0%, #FFB84D 100%);">
      <image class="btn-icon-img" src="/images/share.png" mode="aspectFit"></image>
      <text class="btn-text">åˆ†äº«</text>
    </button>
    <button class="action-btn edit-btn" bindtap="editRecord" style="background: linear-gradient(135deg, {{themeColors.primary}} 0%, {{themeColors.primaryLight}} 100%); box-shadow: 0 8rpx 24rpx {{themeColors.shadow}};">
      <text class="btn-icon">âœï¸</text>
      <text class="btn-text">ç¼–è¾‘</text>
    </button>
    <button class="action-btn delete-btn" bindtap="deleteRecord">
      <text class="btn-icon">ğŸ—‘</text>
      <text class="btn-text">åˆ é™¤</text>
    </button>
  </view>

  <!-- åˆ†äº«å¹³å°é€‰æ‹©å¼¹çª— -->
  <view wx:if="{{showShareModal}}" class="share-modal-mask" catchtap="hideShareModal">
    <view class="share-modal" catchtap="stopPropagation">
      <view class="share-modal-title">é€‰æ‹©åˆ†äº«å¹³å°</view>
      <view class="share-modal-desc">ç”¨AIç”Ÿæˆä¸“å±æ–‡æ¡ˆï¼Œä¸€é”®åˆ†äº«åˆ°ä¸åŒå¹³å°</view>
      
      <view class="platform-list">
        <view 
          wx:for="{{platforms}}" 
          wx:key="code" 
          class="platform-item {{generating && selectedPlatform === item.code ? 'loading' : ''}}"
          bindtap="selectPlatform"
          data-platform="{{item.code}}"
        >
          <image class="platform-icon-img" src="{{item.icon}}" mode="aspectFit"></image>
          <view class="platform-info">
            <view class="platform-name">{{item.name}}</view>
            <view class="platform-hint" wx:if="{{item.code === 'xiaohongshu'}}">æ ‡é¢˜+æ­£æ–‡+è¯é¢˜</view>
            <view class="platform-hint" wx:elif="{{item.code === 'moments'}}">ç®€æ´æ¸©é¦¨çš„ç”Ÿæ´»è®°å½•</view>
            <view class="platform-hint" wx:else>è¿åŠ¨æ‰“å¡+çƒ­é—¨è¯é¢˜</view>
          </view>
          <view class="platform-arrow" wx:if="{{!generating || selectedPlatform !== item.code}}">></view>
          <view class="platform-loading" wx:else>
            <view class="loading-spinner"></view>
          </view>
        </view>
      </view>
      
      <button class="share-modal-close" bindtap="hideShareModal">å–æ¶ˆ</button>
    </view>
  </view>

  <!-- æ–‡æ¡ˆé¢„è§ˆå¼¹çª— -->
  <view wx:if="{{showContentModal}}" class="share-modal-mask" catchtap="hideContentModal">
    <view class="content-modal" catchtap="stopPropagation">
      <view class="content-modal-header">
        <view class="content-platform">{{shareContent.platformName}}</view>
        <view class="content-title">AIç”Ÿæˆæ–‡æ¡ˆ</view>
      </view>
      
      <!-- å°çº¢ä¹¦æ ‡é¢˜ -->
      <view wx:if="{{shareContent.title}}" class="content-title-section">
        <view class="section-label">æ ‡é¢˜</view>
        <view class="section-text">{{shareContent.title}}</view>
      </view>
      
      <!-- æ­£æ–‡ -->
      <view class="content-body-section">
        <view class="section-label">æ–‡æ¡ˆ</view>
        <scroll-view scroll-y class="content-scroll">
          <view class="section-text">{{shareContent.body || shareContent.content}}</view>
        </scroll-view>
      </view>
      
      <view class="content-modal-actions">
        <button class="action-regenerate" bindtap="regenerateContent">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
        <button class="action-copy" bindtap="copyAndShare">å¤åˆ¶å¹¶åˆ†äº«</button>
      </view>
    </view>
  </view>
</view>
